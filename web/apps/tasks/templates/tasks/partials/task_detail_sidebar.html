<!-- Nagłówek -->
<h4 class="mb-1">{{ task.title }}</h4>
<div class="mb-3">
    <span class="badge bg-secondary">{{ task.get_status_display }}</span>
    {% if task.is_private %}<span class="badge bg-dark">Prywatne</span>{% endif %}
</div>

<!-- Zakładki -->
<ul class="nav nav-tabs nav-fill mb-3" id="taskSidebarTabs" role="tablist">
    <li class="nav-item">
        <a class="nav-link active" data-bs-toggle="tab" href="#details-tab">Szczegóły</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#history-tab">Historia</a>
    </li>
</ul>

<div class="tab-content">

    <!-- ZAKŁADKA 1: Szczegóły (To co było wcześniej) -->
    <div class="tab-pane fade show active" id="details-tab">
        <p class="text-muted small">{{ task.description|default:"Brak opisu."|linebreaks }}</p>

        <hr>
        <h6>Checklista</h6>
        {% include 'tasks/partials/checklist.html' %}

        <!-- Sekcja Overrun Migration (którą dodaliśmy wcześniej) -->
        {% if task.status != 'done' %}
        <hr>
        <div class="card bg-light border-warning mt-3">
            <div class="card-body p-2">
                <h6 class="card-title text-warning small fw-bold"><i class="bi bi-hourglass-split"></i> Nie zdążyłeś?</h6>
                <form hx-post="{% url 'task_split' task.id %}"
                      hx-swap="outerHTML"
                      hx-on="htmx:afterRequest: window.location.reload()"
                      class="d-flex gap-2">
                    {% csrf_token %}
                    <input type="number" name="remaining_minutes" class="form-control form-control-sm" placeholder="Minuty?" required style="max-width: 80px;">
                    <button type="submit" class="btn btn-sm btn-warning">Przełóż</button>
                </form>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- ZAKŁADKA 2: Historia (Activity Log) -->
    <div class="tab-pane fade" id="history-tab">
        <div class="list-group list-group-flush">
            {% for log in activities %}
            <div class="list-group-item px-0 py-2">
                <div class="d-flex w-100 justify-content-between">
                    <small class="fw-bold">{{ log.action_type }}</small>
                    <small class="text-muted">{{ log.timestamp|date:"d.m H:i" }}</small>
                </div>
                <p class="mb-1 small">{{ log.description }}</p>
                {% if log.details %}
                    <small class="text-muted fst-italic" style="font-size: 0.75rem;">
                        {{ log.details }}
                    </small>
                {% endif %}
            </div>
            {% empty %}
            <div class="text-center text-muted py-3 small">Brak historii.</div>
            {% endfor %}
        </div>
    </div>

</div>